<!DOCTYPE html><html lang="en"><head><script src="https://djblue.github.io/portal/main.js"></script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-162423165-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-162423165-1');</script><meta charset="UTF-8" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>Blog | Porting Portal to Basilisp</title><meta content="I recently got the Portal data inspector ported to the Basilisp Python Clojure
runtime and it was a fun adventure! In this post, I&apos;ll detail the journey and
learnings I made along the way." name="Description" /><meta content="var(--primary)" name="theme-color" /><link href="https://fonts.googleapis.com/css?family=Lato|Roboto:300,400" rel="stylesheet" /><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&amp;display=swap" rel="stylesheet" /><style>a { text-decoration: none; color: inherit; }</style><style>@media print { @page { margin: 0 0 0 0; size:8.5in 11in; } }</style></head><body style="font-family:Roboto, sans-serif;margin:0;min-height:100vh;padding:0;"><div><style>.G__7084{width:7.5vh;height:7.5vh;display:block;background:var(--primary)}.G__7086{fill-opacity:1;stroke-width:.5;stroke-linejoin:round;stroke-opacity:1;stroke-miterlimit:4;stroke:none;stroke-dasharray:none;fill:auto;stroke-linecap:round;opacity:1}.G__7070{margin-top:40px;margin-bottom:10px}.G__7113{position:fixed;top:0;right:0;width:7.5vh;height:7.5vh;z-index:2;background:var(--primary)}@media(min-width:850px){.G__7113{max-width:2.1em;max-height:2.1em;margin:1em}}.G__7053{margin-top:40px;margin-bottom:0}.G__7072{position:relative}.G__7069{margin-bottom:40px}.G__7088{height:7.5vh;background:var(--primary)}@media(min-width:850px){.G__7088{display:none}}.G__7112{position:absolute;background:var(--background);bottom:0;z-index:0;width:100%;clip-path:polygon(0 0,0 100%,100% 100%);height:36vh}.G__7048{background:var(--primary);position:relative;margin:0 auto;color:var(--background);height:100vh;display:flex}.G__7099{position:absolute;bottom:0;color:var(--primary);font-weight:100}.G__7097{z-index:1;padding:20px;width:260px;box-sizing:border-box;height:100vh;display:flex;flex-direction:column;justify-content:space-between}.G__7077{text-transform:uppercase;margin:10px 0;padding-left:10px;font-size:1.6rem;list-style:none;font-weight:bold;border-left:6px solid var(--background)}.G__7077:hover{font-weight:bold}@media(max-width:850px){.G__7077{font-size:3.2rem}}.G__7081{opacity:1;fill:auto;fill-opacity:1;stroke:none;stroke-width:.295915;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1}.G__7079{width:100%;opacity:1}.G__7095{display:none}.G__7089{flex:1;position:fixed;top:0;right:0;left:0;opacity:.25;height:7.5vh;background:var(--primary)}@media(min-width:850px){.G__7089{display:none}}.G__7052{margin-top:80px}.G__7051{max-width:800px}.G__7073{margin:0;padding:0}@media(min-width:850px){.G__7073{margin-top:40px}}.G__7071{width:100vw;top:0;height:100vh;position:absolute;z-index:2;overflow:auto;font-size:3em;box-sizing:border-box;transition:left .25s ease-in-out;background:var(--primary)}@media(min-width:850px){.G__7071{display:none}}.G__7074{text-transform:uppercase;margin:10px 0;padding-left:10px;font-size:1.6rem;list-style:none;font-weight:100;border-left:6px solid rgba(0,0,0,0)}.G__7074:hover{font-weight:bold}@media(max-width:850px){.G__7074{font-size:3.2rem}}.G__7049{z-index:1;overflow:auto;flex:1}.G__7082{fill-opacity:1;stroke-width:26.4884;stroke-linejoin:round;stroke-opacity:1;stroke-miterlimit:4;stroke:none;stroke-dasharray:none;fill:auto;stroke-linecap:round;opacity:1}.G__7050{background:var(--background);padding-top:10vh;color:var(--foreground);padding:40px 80px;box-sizing:border-box;min-height:100vh}@media(min-width:850px){.G__7050{border-left:1px solid var(--highlight)}}@media(max-width:850px){.G__7050{min-height:calc(100vh - 7.5vh);padding:10px 20px}}@media(max-width:850px){.G__7096{display:none}}.G__7080{fill:auto}.G__7054{text-align:right;font-weight:100;border:1px solid var(--highlight);color:var(--foreground);padding:10px}.G__7090{width:7.5vh;right:0;top:0;height:7.5vh;position:fixed;z-index:2;display:flex;background:var(--primary);left:0}@media(min-width:850px){.G__7090{display:none}}</style><div class="light" id="switcher"><script>document.getElementById('switcher').className = window.localStorage.getItem('theme') || 'light';</script><style>.light {
  --package: #8cd0d3;
  --border-radius: 0;
  --keyword: #afd8af;
  --diff-add: #9fc59f;
  --exception: #cc9393;
  --number: #8cd0d3;
  --background: var(--background);
  --diff-remove: #cc9393;
  --font-size: 0.9em;
  --font-family: 'Roboto Mono';
  --background2: var(--highlight);
  --boolean: #bfebbf;
  --text: var(--foreground);
  --code-comment: #656565;
  --uri: #dfaf8f;
  --symbol: var(--foreground);
  --namespace: #0c607e;
  --string: #cc9393;
  --border: var(--highlight);
  --tag: #f0dfaf;
  --foreground: #1c1c1e;
  --background: #ffffff;
  --primary: #1083ac;
  --secondary: #1c1c1e;
  --highlight: #f2f2f2;
}

.dark {
  --package: #8cd0d3;
  --border-radius: 0;
  --keyword: #afd8af;
  --diff-add: #9fc59f;
  --exception: #cc9393;
  --number: #8cd0d3;
  --background: var(--background);
  --diff-remove: #cc9393;
  --font-size: 0.9em;
  --font-family: 'Roboto Mono';
  --background2: var(--highlight);
  --boolean: #bfebbf;
  --text: var(--foreground);
  --code-comment: #656565;
  --uri: #dfaf8f;
  --symbol: var(--foreground);
  --namespace: #0c607e;
  --string: #cc9393;
  --border: var(--highlight);
  --tag: #f0dfaf;
  --foreground: #c1c1c1;
  --background: #1c1c1e;
  --primary: #0c607e;
  --secondary: #1c1c1e;
  --highlight: #111113;
}</style><div class="G__7113" onclick="window.theme = document.getElementById(&apos;switcher&apos;).className === &apos;dark&apos; ? &apos;light&apos; : &apos;dark&apos;;
              document.getElementById(&apos;switcher&apos;).className = window.theme;
              window.localStorage.setItem(&apos;theme&apos;, theme);"><svg fill="var(--background)" height="100%" label="icon.theme" viewBox="-1968.4595 -208.47198 177.34795 177.34795" width="100%"><path class="G__7086" connector-curvature="0" d="m -1879.7855,-182.28567 a 62.487613,62.487613 0 0 0 -62.4877,62.48766 62.487613,62.487613 0 0 0 62.4877,62.487654 62.487613,62.487613 0 0 0 62.4877,-62.487654 62.487613,62.487613 0 0 0 -62.4877,-62.48766 z m -0.021,17.21238 v 90.549516 a 45.275454,45.275454 0 0 1 -45.2546,-45.274236 45.275454,45.275454 0 0 1 45.2546,-45.27528 z" id="path343" label="icon.theme"></path></svg></div><div class="G__7048"><div class="G__7112"></div><div class="G__7096"><div class="G__7097"><nav class="G__7072"><div class="G__7079"><a href="/index.html"><svg fill="var(--background)" height="100%" label="icon.glasses" viewBox="-1968.4595 -585.75818 256 132.63841" width="60%"><g class="G__7080" id="g1216" label="icon.glasses" transform="matrix(0.85295192,0,0,0.85295192,-4155.2496,-336.56087)">
        <path class="G__7082" connector-curvature="0" d="m 2813.4864,-217.48174 c -0.6426,-0.36902 -0.9055,-1.12223 -1.1388,-1.78772 -0.4212,-0.67398 -0.5929,-1.50151 -0.9733,-2.19229 -0.311,-0.59729 -0.4562,-1.28017 -0.7996,-1.87486 -0.2679,-0.74651 -0.6178,-1.44573 -0.8988,-2.18658 -0.2752,-0.74946 -0.6701,-1.42632 -0.9053,-2.19437 -0.3707,-0.65013 -0.52,-1.37378 -0.9226,-1.97759 -0.1762,-0.77539 -0.6051,-1.47218 -0.8789,-2.21401 -0.2594,-0.71545 -0.69,-1.38897 -0.79,-2.15985 -0.2047,-0.73103 0.5182,-1.31539 1.1101,-1.46882 0.7491,0.15534 1.2959,0.78197 1.4003,1.53824 0.3895,0.6637 0.5715,1.41541 0.9509,2.08234 0.2629,0.71914 0.5366,1.36777 0.8881,2.03291 0.1647,0.79577 0.6333,1.48563 0.8667,2.26258 0.4244,0.65452 0.5343,1.46958 0.9555,2.12825 0.2842,0.69581 0.4994,1.44105 0.9005,2.06023 -0.021,0.56593 0.5387,0.76239 0.4856,1.3572 0.397,0.67606 0.5319,1.46813 0.9889,2.10908 0.045,0.67092 0.6833,1.17252 0.3529,1.87474 -0.383,0.38634 -0.7943,0.93812 -1.4521,0.73098 l -0.084,-0.0462 z" id="path1210"></path>
        <path class="G__7082" connector-curvature="0" d="m 2821.5718,-217.44178 c -0.8819,-0.30145 -0.9149,-1.33803 -1.4296,-1.92631 -0.1529,-0.74143 -0.661,-1.37764 -0.8791,-2.12213 -0.4285,-0.70222 -0.6612,-1.47553 -1.0789,-2.1729 -0.2577,-0.75494 -0.6745,-1.36967 -0.9582,-2.08436 -0.3109,-0.71002 -0.6455,-1.4455 -0.9821,-2.15973 -0.3613,-0.72722 -0.6411,-1.49574 -1.0659,-2.18687 -0.2163,-0.67126 -0.585,-1.24932 -0.8605,-1.88635 -0.3081,-0.72889 -0.6473,-1.45433 -0.979,-2.17855 -0.3982,-0.80443 -0.7488,-1.62163 -1.1486,-2.42629 -0.3094,-0.85375 -0.9851,-1.61476 -0.9699,-2.56114 -0.2299,-0.91236 1.0546,-1.7064 1.7187,-1.07741 0.6596,0.41002 0.822,1.41183 1.1764,2.09754 0.4417,0.78878 0.8408,1.59339 1.1454,2.44685 0.4732,0.69269 0.7139,1.54621 1.0967,2.29076 0.4209,0.73178 0.6451,1.58709 1.1255,2.2307 0.1607,0.78664 0.7267,1.43972 0.9339,2.23462 0.3827,0.7345 0.7796,1.49643 1.051,2.26795 0.4669,0.68639 0.6087,1.39907 1.0728,2.06825 0.1797,0.75316 0.6485,1.40196 0.9094,2.14454 0.4043,0.68853 0.6129,1.43712 1.054,2.08471 0.2019,0.73248 0.6945,1.42754 0.4669,2.25034 -0.024,0.49952 -0.9798,0.96532 -1.3989,0.66578 z" id="path1212"></path>
        <path class="G__7081" connector-curvature="0" d="m 2640.1636,-250.74435 c -5.674,-0.009 -11.2859,0.2095 -16.4719,0.82434 -3.1481,0.37321 -9.402,1.23969 -13.9144,2.62346 -7.7351,2.37208 -15.2087,4.95932 -22.272,9.64802 -3.1294,6.69342 -2.7606,20.39371 -1.1419,20.47028 0.069,-0.23096 7.5068,2.43064 7.8616,7.73262 0.2888,4.31642 1.8398,16.60309 7.692,22.19195 3.4073,3.25404 8.124,5.30461 12.7128,6.6543 6.7518,1.986 13.9956,1.63421 21.0286,1.89632 11.6277,0.43327 22.9737,1.42087 34.9034,-0.53918 5.2441,-0.92247 7.6639,-2.15845 10.5162,-3.54369 2.8526,-1.38552 4.0937,-1.98179 6.6351,-4.34074 2.5418,-2.35914 6.0502,-7.01702 7.8318,-10.22339 1.7815,-3.20653 2.067,-5.49476 3.2213,-8.54297 1.154,-3.04792 2.6842,-7.21601 3.7061,-9.74518 1.0226,-2.52913 1.2831,-3.83711 2.3402,-5.46163 1.0571,-1.62425 1.9265,-3.47943 3.6573,-4.17433 1.2256,-0.49183 3.6207,-0.5459 4.9291,-0.53664 v 0.0172 c 0,0 0.2501,-0.007 0.4592,-0.0114 0.2084,0.005 0.4584,0.0114 0.4584,0.0114 v -0.0172 c 1.3081,-0.009 3.7038,0.0448 4.9294,0.53664 1.7308,0.6949 2.5996,2.55008 3.6567,4.17433 1.0571,1.62452 1.3182,2.9325 2.3408,5.46163 1.0219,2.52917 2.5521,6.69726 3.7061,9.74518 1.1546,3.04821 1.4398,5.33644 3.2213,8.54297 1.7816,3.20637 5.29,7.86425 7.8318,10.22339 2.5414,2.35895 3.7828,2.95522 6.6351,4.34074 2.8523,1.38524 5.2721,2.62122 10.5162,3.54369 11.9297,1.96005 23.2757,0.97245 34.9033,0.53918 7.0332,-0.26211 14.2764,0.0897 21.0279,-1.89632 4.589,-1.34969 9.3064,-3.40026 12.7137,-6.6543 5.8521,-5.58886 7.4031,-17.87553 7.6919,-22.19195 0.3547,-5.30198 7.792,-7.96358 7.861,-7.73262 1.6186,-0.0766 1.988,-13.77686 -1.1413,-20.47028 -7.0634,-4.6887 -14.5368,-7.27594 -22.272,-9.64802 -4.5125,-1.38377 -10.7662,-2.25025 -13.9144,-2.62346 -8.2974,-0.98376 -17.6856,-0.95222 -26.6736,-0.59953 -8.9877,0.35273 -20.4059,1.4265 -27.0495,2.77336 -6.6439,1.34687 -9.4945,2.33791 -12.8115,3.60658 -3.3172,1.26866 -4.387,3.35962 -7.7579,4.28608 -3.3706,0.92651 -8.6114,0.86726 -12.9328,1.0409 -1.9561,0.0786 -3.9168,0.0786 -5.873,0 -4.3213,-0.17364 -9.5622,-0.11439 -12.9327,-1.0409 -3.3706,-0.92646 -4.4407,-3.01742 -7.758,-4.28608 -3.3169,-1.26867 -6.1675,-2.25971 -12.8111,-3.60658 -6.644,-1.34686 -18.0628,-2.42063 -27.0504,-2.77336 -3.3705,-0.13224 -6.7968,-0.21948 -10.2012,-0.22481 z m 10.0747,5.2387 c 1.7895,0.006 3.5675,0.043 5.3402,0.12385 v 0 c 1.0132,0.0479 2.0261,0.1061 3.0402,0.18102 8.314,0.63291 18.5054,1.91758 24.3449,3.44653 5.8398,1.52895 8.229,1.72918 10.7129,4.18701 2.4842,2.4577 2.849,4.0403 3.4574,8.39057 0.6084,4.3505 -0.2357,12.60354 -1.2928,17.25874 -1.0574,4.65543 -1.5621,7.40333 -3.754,11.75897 -2.1922,4.35558 -6.1389,10.22186 -10.2775,13.25587 -4.1386,3.03371 -14.5303,4.89767 -25.1463,4.76813 -10.6163,-0.12909 -21.3294,0.6309 -31.8926,-0.58112 -5.3089,-0.60879 -12.4557,-1.97601 -15.6863,-4.08222 -7.1017,-4.28075 -9.4068,-13.45619 -10.7308,-20.34327 -1.5847,-8.24269 -1.169,-18.89584 -0.2737,-26.02714 5.1188,-11.63811 24.4578,-11.40881 35.5322,-11.94126 5.7814,-0.15864 11.2576,-0.41376 16.6262,-0.39503 z m 127.2298,0 c 5.3687,-0.0189 10.8453,0.23639 16.6266,0.39503 11.0745,0.53245 30.4135,0.30315 35.5325,11.94126 0.8951,7.1313 1.311,17.78445 -0.2738,26.02714 -1.3241,6.88708 -3.6291,16.06252 -10.7308,20.34327 -3.2308,2.10621 -10.3781,3.47343 -15.6869,4.08222 -10.5634,1.21202 -21.2757,0.45203 -31.892,0.58112 -10.6161,0.12954 -21.0078,-1.73442 -25.1464,-4.76813 -4.1386,-3.03401 -8.0853,-8.90029 -10.2775,-13.25587 -2.1919,-4.35564 -2.6972,-7.10354 -3.7543,-11.75897 -1.0574,-4.6552 -1.9008,-12.90824 -1.2925,-17.25874 0.6084,-4.35027 0.9726,-5.93287 3.4568,-8.39057 2.4838,-2.45783 4.8741,-2.65806 10.7136,-4.18701 5.8398,-1.52895 16.0308,-2.81362 24.3448,-3.44653 1.0141,-0.0749 2.027,-0.13309 3.0402,-0.18102 v 0 c 1.7727,-0.0808 3.5501,-0.11758 5.3397,-0.12385 z" id="path1214" nodetypes="ccccccccccccccccccccccccccccccccccccccccccaaccccccccccccccccccccccccccccccccccccccc"></path>
      </g></svg></a></div><ul class="G__7073"><li class="G__7074"><a href="/index.html">home</a></li><li class="G__7077"><a href="/blog/index.html">blog</a></li><li class="G__7074"><a href="/projects.html">projects</a></li><li class="G__7074"><a href="/resume.html">resume</a></li><li class="G__7074"><a href="/contact.html">contact</a></li></ul></nav><div class="G__7072"><div class="G__7099">© 2025. All rights reserved.</div></div></div></div><style>#menu-btn:checked ~ .mobile-nav {
  left: 0;
}

.mobile-nav {
  left: -100vw;
}</style><div class="G__7049"><div><input class="G__7095" id="menu-btn" type="checkbox" /><label class="G__7090" for="menu-btn"><svg fill="var(--background)" height="100%" label="icon.menu" viewBox="-1968.4595 -393.10843 256 256" width="100%"><g class="G__7080" id="g274" label="icon.menu" transform="translate(0.60988617,-1.415905)">
        <rect class="G__7086" height="46.772163" id="rect265" rx="0" ry="0" width="181.24214" x="-1931.6904" y="-353.22443"></rect>
        <rect class="G__7086" height="46.772163" id="rect267" rx="0" ry="0" width="181.24214" x="-1931.6904" y="-287.07861"></rect>
        <rect class="G__7086" height="46.772163" id="rect269" rx="0" ry="0" width="181.24214" x="-1931.6904" y="-220.93279"></rect>
      </g></svg></label><div class="G__7089"></div><div class="G__7088"></div><div class="mobile-nav G__7071"><label class="G__7084" for="menu-btn"><svg fill="var(--background)" height="100%" label="icon.close" viewBox="-1968.4595 -75.608429 256 256" width="100%"><g class="G__7080" id="g288" label="icon.close" transform="translate(0.60988617,316.08409)">
        <rect class="G__7086" height="46.772163" id="rect284" rx="0" ry="0" transform="rotate(-45)" width="181.24214" x="-1205.9949" y="-1511.6775"></rect>
        <rect class="G__7086" height="46.772163" id="rect329" rx="0" ry="0" transform="rotate(45)" width="181.24214" x="-1578.9125" y="1091.9877"></rect>
      </g></svg></label><nav class="G__7072"><div class="G__7079"><a href="/index.html"><svg fill="var(--background)" height="100%" label="icon.glasses" viewBox="-1968.4595 -585.75818 256 132.63841" width="60%"><g class="G__7080" id="g1216" label="icon.glasses" transform="matrix(0.85295192,0,0,0.85295192,-4155.2496,-336.56087)">
        <path class="G__7082" connector-curvature="0" d="m 2813.4864,-217.48174 c -0.6426,-0.36902 -0.9055,-1.12223 -1.1388,-1.78772 -0.4212,-0.67398 -0.5929,-1.50151 -0.9733,-2.19229 -0.311,-0.59729 -0.4562,-1.28017 -0.7996,-1.87486 -0.2679,-0.74651 -0.6178,-1.44573 -0.8988,-2.18658 -0.2752,-0.74946 -0.6701,-1.42632 -0.9053,-2.19437 -0.3707,-0.65013 -0.52,-1.37378 -0.9226,-1.97759 -0.1762,-0.77539 -0.6051,-1.47218 -0.8789,-2.21401 -0.2594,-0.71545 -0.69,-1.38897 -0.79,-2.15985 -0.2047,-0.73103 0.5182,-1.31539 1.1101,-1.46882 0.7491,0.15534 1.2959,0.78197 1.4003,1.53824 0.3895,0.6637 0.5715,1.41541 0.9509,2.08234 0.2629,0.71914 0.5366,1.36777 0.8881,2.03291 0.1647,0.79577 0.6333,1.48563 0.8667,2.26258 0.4244,0.65452 0.5343,1.46958 0.9555,2.12825 0.2842,0.69581 0.4994,1.44105 0.9005,2.06023 -0.021,0.56593 0.5387,0.76239 0.4856,1.3572 0.397,0.67606 0.5319,1.46813 0.9889,2.10908 0.045,0.67092 0.6833,1.17252 0.3529,1.87474 -0.383,0.38634 -0.7943,0.93812 -1.4521,0.73098 l -0.084,-0.0462 z" id="path1210"></path>
        <path class="G__7082" connector-curvature="0" d="m 2821.5718,-217.44178 c -0.8819,-0.30145 -0.9149,-1.33803 -1.4296,-1.92631 -0.1529,-0.74143 -0.661,-1.37764 -0.8791,-2.12213 -0.4285,-0.70222 -0.6612,-1.47553 -1.0789,-2.1729 -0.2577,-0.75494 -0.6745,-1.36967 -0.9582,-2.08436 -0.3109,-0.71002 -0.6455,-1.4455 -0.9821,-2.15973 -0.3613,-0.72722 -0.6411,-1.49574 -1.0659,-2.18687 -0.2163,-0.67126 -0.585,-1.24932 -0.8605,-1.88635 -0.3081,-0.72889 -0.6473,-1.45433 -0.979,-2.17855 -0.3982,-0.80443 -0.7488,-1.62163 -1.1486,-2.42629 -0.3094,-0.85375 -0.9851,-1.61476 -0.9699,-2.56114 -0.2299,-0.91236 1.0546,-1.7064 1.7187,-1.07741 0.6596,0.41002 0.822,1.41183 1.1764,2.09754 0.4417,0.78878 0.8408,1.59339 1.1454,2.44685 0.4732,0.69269 0.7139,1.54621 1.0967,2.29076 0.4209,0.73178 0.6451,1.58709 1.1255,2.2307 0.1607,0.78664 0.7267,1.43972 0.9339,2.23462 0.3827,0.7345 0.7796,1.49643 1.051,2.26795 0.4669,0.68639 0.6087,1.39907 1.0728,2.06825 0.1797,0.75316 0.6485,1.40196 0.9094,2.14454 0.4043,0.68853 0.6129,1.43712 1.054,2.08471 0.2019,0.73248 0.6945,1.42754 0.4669,2.25034 -0.024,0.49952 -0.9798,0.96532 -1.3989,0.66578 z" id="path1212"></path>
        <path class="G__7081" connector-curvature="0" d="m 2640.1636,-250.74435 c -5.674,-0.009 -11.2859,0.2095 -16.4719,0.82434 -3.1481,0.37321 -9.402,1.23969 -13.9144,2.62346 -7.7351,2.37208 -15.2087,4.95932 -22.272,9.64802 -3.1294,6.69342 -2.7606,20.39371 -1.1419,20.47028 0.069,-0.23096 7.5068,2.43064 7.8616,7.73262 0.2888,4.31642 1.8398,16.60309 7.692,22.19195 3.4073,3.25404 8.124,5.30461 12.7128,6.6543 6.7518,1.986 13.9956,1.63421 21.0286,1.89632 11.6277,0.43327 22.9737,1.42087 34.9034,-0.53918 5.2441,-0.92247 7.6639,-2.15845 10.5162,-3.54369 2.8526,-1.38552 4.0937,-1.98179 6.6351,-4.34074 2.5418,-2.35914 6.0502,-7.01702 7.8318,-10.22339 1.7815,-3.20653 2.067,-5.49476 3.2213,-8.54297 1.154,-3.04792 2.6842,-7.21601 3.7061,-9.74518 1.0226,-2.52913 1.2831,-3.83711 2.3402,-5.46163 1.0571,-1.62425 1.9265,-3.47943 3.6573,-4.17433 1.2256,-0.49183 3.6207,-0.5459 4.9291,-0.53664 v 0.0172 c 0,0 0.2501,-0.007 0.4592,-0.0114 0.2084,0.005 0.4584,0.0114 0.4584,0.0114 v -0.0172 c 1.3081,-0.009 3.7038,0.0448 4.9294,0.53664 1.7308,0.6949 2.5996,2.55008 3.6567,4.17433 1.0571,1.62452 1.3182,2.9325 2.3408,5.46163 1.0219,2.52917 2.5521,6.69726 3.7061,9.74518 1.1546,3.04821 1.4398,5.33644 3.2213,8.54297 1.7816,3.20637 5.29,7.86425 7.8318,10.22339 2.5414,2.35895 3.7828,2.95522 6.6351,4.34074 2.8523,1.38524 5.2721,2.62122 10.5162,3.54369 11.9297,1.96005 23.2757,0.97245 34.9033,0.53918 7.0332,-0.26211 14.2764,0.0897 21.0279,-1.89632 4.589,-1.34969 9.3064,-3.40026 12.7137,-6.6543 5.8521,-5.58886 7.4031,-17.87553 7.6919,-22.19195 0.3547,-5.30198 7.792,-7.96358 7.861,-7.73262 1.6186,-0.0766 1.988,-13.77686 -1.1413,-20.47028 -7.0634,-4.6887 -14.5368,-7.27594 -22.272,-9.64802 -4.5125,-1.38377 -10.7662,-2.25025 -13.9144,-2.62346 -8.2974,-0.98376 -17.6856,-0.95222 -26.6736,-0.59953 -8.9877,0.35273 -20.4059,1.4265 -27.0495,2.77336 -6.6439,1.34687 -9.4945,2.33791 -12.8115,3.60658 -3.3172,1.26866 -4.387,3.35962 -7.7579,4.28608 -3.3706,0.92651 -8.6114,0.86726 -12.9328,1.0409 -1.9561,0.0786 -3.9168,0.0786 -5.873,0 -4.3213,-0.17364 -9.5622,-0.11439 -12.9327,-1.0409 -3.3706,-0.92646 -4.4407,-3.01742 -7.758,-4.28608 -3.3169,-1.26867 -6.1675,-2.25971 -12.8111,-3.60658 -6.644,-1.34686 -18.0628,-2.42063 -27.0504,-2.77336 -3.3705,-0.13224 -6.7968,-0.21948 -10.2012,-0.22481 z m 10.0747,5.2387 c 1.7895,0.006 3.5675,0.043 5.3402,0.12385 v 0 c 1.0132,0.0479 2.0261,0.1061 3.0402,0.18102 8.314,0.63291 18.5054,1.91758 24.3449,3.44653 5.8398,1.52895 8.229,1.72918 10.7129,4.18701 2.4842,2.4577 2.849,4.0403 3.4574,8.39057 0.6084,4.3505 -0.2357,12.60354 -1.2928,17.25874 -1.0574,4.65543 -1.5621,7.40333 -3.754,11.75897 -2.1922,4.35558 -6.1389,10.22186 -10.2775,13.25587 -4.1386,3.03371 -14.5303,4.89767 -25.1463,4.76813 -10.6163,-0.12909 -21.3294,0.6309 -31.8926,-0.58112 -5.3089,-0.60879 -12.4557,-1.97601 -15.6863,-4.08222 -7.1017,-4.28075 -9.4068,-13.45619 -10.7308,-20.34327 -1.5847,-8.24269 -1.169,-18.89584 -0.2737,-26.02714 5.1188,-11.63811 24.4578,-11.40881 35.5322,-11.94126 5.7814,-0.15864 11.2576,-0.41376 16.6262,-0.39503 z m 127.2298,0 c 5.3687,-0.0189 10.8453,0.23639 16.6266,0.39503 11.0745,0.53245 30.4135,0.30315 35.5325,11.94126 0.8951,7.1313 1.311,17.78445 -0.2738,26.02714 -1.3241,6.88708 -3.6291,16.06252 -10.7308,20.34327 -3.2308,2.10621 -10.3781,3.47343 -15.6869,4.08222 -10.5634,1.21202 -21.2757,0.45203 -31.892,0.58112 -10.6161,0.12954 -21.0078,-1.73442 -25.1464,-4.76813 -4.1386,-3.03401 -8.0853,-8.90029 -10.2775,-13.25587 -2.1919,-4.35564 -2.6972,-7.10354 -3.7543,-11.75897 -1.0574,-4.6552 -1.9008,-12.90824 -1.2925,-17.25874 0.6084,-4.35027 0.9726,-5.93287 3.4568,-8.39057 2.4838,-2.45783 4.8741,-2.65806 10.7136,-4.18701 5.8398,-1.52895 16.0308,-2.81362 24.3448,-3.44653 1.0141,-0.0749 2.027,-0.13309 3.0402,-0.18102 v 0 c 1.7727,-0.0808 3.5501,-0.11758 5.3397,-0.12385 z" id="path1214" nodetypes="ccccccccccccccccccccccccccccccccccccccccccaaccccccccccccccccccccccccccccccccccccccc"></path>
      </g></svg></a></div><ul class="G__7073"><li class="G__7074"><a href="/index.html">home</a></li><li class="G__7077"><a href="/blog/index.html">blog</a></li><li class="G__7074"><a href="/projects.html">projects</a></li><li class="G__7074"><a href="/resume.html">resume</a></li><li class="G__7074"><a href="/contact.html">contact</a></li></ul></nav></div><div class="G__7050"><style>.highlight .hll{background-color:#ffc}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{color:var(--primary);font-weight:var(--keyword)}.highlight .o{color:var(--primary);font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold;font-style:italic}.highlight .c1{color:var(--code-comment);font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:var(--primary);background-color:#fdd}.highlight .ge{color:var(--primary);font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:var(--primary);background-color:#dfd}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{color:var(--primary);font-weight:bold}.highlight .kd{color:var(--primary);font-weight:bold}.highlight .kn{color:var(--primary);font-weight:bold}.highlight .kp{color:var(--primary);font-weight:bold}.highlight .kr{color:var(--primary);font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:var(--number)}.highlight .s{color:var(--string)}.highlight .na{color:teal}.highlight .nb{color:var(--primary)}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .nd{color:#3c5d5d;font-weight:bold}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:var(--primary);font-weight:bold}.highlight .nl{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:var(--keyword)}.highlight .nv{color:var(--symbol)}.highlight .ow{color:var(--primary);font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d01040}.highlight .sc{color:#d01040}.highlight .sd{color:#d01040}.highlight .s2{color:var(--string)}.highlight .se{color:#d01040}.highlight .sh{color:#d01040}.highlight .si{color:#d01040}.highlight .sx{color:#d01040}.highlight .sr{color:#009926}.highlight .s1{color:var(--string)}.highlight .ss{color:var(--keyword)}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}.markdown-body h1{font-size:3em}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-family:Lato}.markdown-body h1{padding-bottom:.3em;border-bottom:1px solid var(--highlight)}.markdown-body p{font-weight:100;font-size:1.2em;line-height:1.5em;letter-spacing:.1px}.markdown-body a{color:var(--primary)}.markdown-body .blog-post a:hover{text-decoration:underline}.markdown-body p code{font-size:.8em;padding:3px}.markdown-body code{font-family:'Roboto Mono',monospace;background:var(--highlight)}.markdown-body pre{margin:0;padding:16px;font-size:12pt;background:var(--highlight);overflow:auto;font-family:'Roboto Mono',monospace}.markdown-body figure{margin:40px 20px;overflow:auto}</style><div class="markdown-body G__7051"><div><article><header class="G__7069"><a href="#porting-portal-to-basilisp"><h1 class="G__7070" id="porting-portal-to-basilisp">Porting Portal to Basilisp</h1></a><span>August 23, 2025</span></header><div class="blog-post">

<div><script type="text/javascript">window.portal.ui.options.patch("{:theme :djblue.github.io.blog/embed, :themes #:djblue.github.io.blog{:embed {:portal.colors/string \"#cc9393\", :portal.colors/keyword \"#afd8af\", :portal.colors/exception \"#cc9393\", :font-size \"0.9em\", :portal.colors/text \"var(--foreground)\", :portal.colors/background2 \"var(--highlight)\", :portal.colors/boolean \"#bfebbf\", :portal.colors/tag \"#f0dfaf\", :portal.colors/uri \"#dfaf8f\", :portal.colors/namespace \"#0c607e\", :portal.colors/diff-add \"#9fc59f\", :portal.colors/package \"#8cd0d3\", :portal.colors/border \"var(--highlight)\", :portal.colors/symbol \"var(--foreground)\", :portal.colors/diff-remove \"#cc9393\", :portal.colors/number \"#8cd0d3\", :portal.colors/background \"var(--background)\", :border-radius 0, :font-family \"'Roboto Mono'\", :djblue.github.io.theme/code-comment \"#656565\"}}}")</script></div>



<p>
Last year I watched the <a href="https://www.youtube.com/watch?v=ruGRHYpq448">Basilisp London Clojurians talk</a> by <a href="https://github.com/chrisrink10">Chris Rink</a>:
</p>

<div>
<style>.youtube-video {aspect-ratio: 16 / 9; width: 100% !important;}</style>
<iframe allow="accelerometer; autoplay;
clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" class="youtube-video" frameborder="0" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/ruGRHYpq448?si=vCD232NcaWmXwa63" title="YouTube video player"></iframe>
</div>

<p>
<a href="https://github.com/basilisp-lang/basilisp">Basilisp</a> is a Clojure-compatible(-ish) Lisp dialect
targeting Python 3.9+. I had heard of it before but hadn't realized how mature
of a Clojure implementation it had become. After the talk, I began to wonder how
difficult it would be to port my visual tool <a href="https://github.com/djblue/portal">Portal</a> to this
python based <a href="https://clojure.org/">Clojure</a> runtime.
</p>

<p>
Portal already had support for other alternative Clojure runtimes: <a href="https://nodejs.org/en">node</a>,
<a href="https://github.com/babashka/babashka">babashka</a>, <a href="https://github.com/babashka/nbb">nbb</a>, <a href="https://github.com/BetterThanTomorrow/joyride">joyride</a> and <a href="https://github.com/clojure/clojure-clr">clojure-clr</a>. So I already
had experience with this type of port, but I was familiar with many of those
runtimes, except the CLR but it felt very similar to the JVM.  This post will
document my journey learning about python, basilisp and porting Portal. I hope
this post sheds some light on how to get your Clojure code working on other
platforms and demonstrates how portable Clojure truly is. If you see anything
that is incorrect or could be improved, please let me know.
</p>

<a href="#getting-started"><h2 class="G__7053" id="getting-started">Getting Started</h2></a>

<p>
As I began my port, I was pleasantly surprised how easy it was to get a
development environment setup. I started by trying to install Basilisp via:
</p>

<execution>
<div><div class="blog-post"><div class="highlight"><pre><span></span>pip install basilisp
</pre></div>
</div></div>
<pre>
error: <b>externally-managed-environment</b>

× This environment is externally managed
╰─> To install Python packages system-wide, try 'pacman -S
    python-xyz', where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Arch-packaged Python package,
    create a virtual environment using 'python -m venv path/to/venv'.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip.
    
    If you wish to install a non-Arch packaged Python application,
    it may be easiest to use 'pipx install xyz', which will manage a
    virtual environment for you. Make sure you have python-pipx
    installed via pacman.

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.
</pre>
</execution>

<p>
Looking at the output, I deciphered that I needed to setup a <a href="https://docs.python.org/3/library/venv.html">virtual environment</a>. I had encountered the concept in passing
before and knew it was best practice, but didn't realize it was enforced. So as
the error message asserted, I setup my virtual env via:
</p>

<div><div class="blog-post"><div class="highlight"><pre><span></span>python -m venv py
./py/bin/pip install basilisp
</pre></div>
</div></div>

<p>
After getting basilisp installed, my second objective was to get an editor
connected repl which was trivial since it has a build-in <a href="https://nrepl.org/nrepl/index.html">nREPL</a> server which can
be started via:
</p>

<div><div class="blog-post"><div class="highlight"><pre><span></span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s1">'dev:src:test'</span> ./py/bin/basilisp nrepl-server
</pre></div>
</div></div>

<p>
You can even automate starting of the nREPL server and editor connection for <a href="https://calva.io/">Calva</a> with <a href="https://calva.io/connect-sequences/">connect-sequences</a> via
the following <a href="https://code.visualstudio.com/docs/getstarted/settings">VS Code workspace settings</a> file:
</p>

<div><div class="G__7054">.vscode/settings.json</div><div class="blog-post"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"calva.replConnectSequences"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"basilisp"</span><span class="p">,</span>
      <span class="nt">"projectType"</span><span class="p">:</span> <span class="s2">"deps.edn"</span><span class="p">,</span>
      <span class="nt">"projectRootPath"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"."</span>
      <span class="p">],</span>
      <span class="nt">"customJackInCommandLine"</span><span class="p">:</span> <span class="s2">"./py/bin/basilisp nrepl-server"</span><span class="p">,</span>
      <span class="nt">"jackInEnv"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"PYTHONPATH"</span><span class="p">:</span> <span class="s2">"dev:src:test"</span>
      <span class="p">},</span>
      <span class="nt">"nReplPortFile"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">".nrepl-port"</span>
      <span class="p">],</span>
      <span class="nt">"menuSelections"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"cljAliases"</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">":dev"</span><span class="p">,</span>
          <span class="s2">":cider"</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div></div>

<a href="#getting-the-remote-client-working"><h2 class="G__7053" id="getting-the-remote-client-working">Getting the Remote Client Working</h2></a>

<p>
Typically, my approach to porting is to start with building a <a href="https://cljdoc.org/d/djblue/portal/0.58.2/doc/remote-api">remote client</a> for Portal. That allows me to still
leverage Portal as a development tool, just in a remote capacity. For clients, I
tend to prefer minimal dependencies or zero dependencies when possible. When
researching how to make a simple http request in python, I stumbled upon an
example via <a href="https://docs.python.org/3/library/urllib.html">urllib</a>, which is perfect since that's built
into python. Next is the question of serialization, which for Clojure is as
simple as <a href="https://clojuredocs.org/clojure.core/pr-str">pr-str</a>. I also found that basilisp has a <a href="https://basilisp.readthedocs.io/en/latest/api/json.html">built-in json library</a> and added that option as well.
</p>

<p>
The Portal client turned out to look like this:
</p>

<div><div class="G__7054">src/portal/client/py.lpy</div><div class="blog-post"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">portal.client.py</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">basilisp.json</span> <span class="ss">:as</span> <span class="nv">json</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:import</span> <span class="p">[</span><span class="nv">urllib.request</span> <span class="ss">:as</span> <span class="nv">request</span><span class="p">]))</span>

<span class="p">(</span><span class="kd">defn- </span><span class="nv">serialize</span> <span class="p">[</span><span class="nv">encoding</span> <span class="nv">value</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">try</span>
    <span class="p">(</span><span class="nf">.encode</span>
     <span class="p">(</span><span class="nf">case</span> <span class="nv">encoding</span>
       <span class="ss">:json</span>    <span class="p">(</span><span class="nf">json/write-str</span>  <span class="nv">value</span><span class="p">)</span>
       <span class="ss">:edn</span>     <span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*print-meta*</span> <span class="nv">true</span><span class="p">]</span>
                  <span class="p">(</span><span class="nb">pr-str </span><span class="nv">value</span><span class="p">)))</span>
     <span class="s">"utf-8"</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">catch</span> <span class="nv">Exception</span> <span class="nv">ex</span>
      <span class="p">(</span><span class="nf">serialize</span>
       <span class="nv">encoding</span>
       <span class="p">{</span><span class="ss">:cause</span> <span class="s">"Error"</span>
        <span class="ss">:message</span> <span class="p">(</span><span class="nf">ex-message</span> <span class="nv">ex</span><span class="p">)</span>
        <span class="ss">:data</span> <span class="p">(</span><span class="nf">ex-data</span> <span class="nv">ex</span><span class="p">)}))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">submit</span>
  <span class="p">([</span><span class="nv">value</span><span class="p">]</span> <span class="p">(</span><span class="nf">submit</span> <span class="nv">nil</span> <span class="nv">value</span><span class="p">))</span>
  <span class="p">([{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">encoding</span> <span class="nv">port</span> <span class="nv">host</span><span class="p">]</span>
     <span class="ss">:or</span>   <span class="p">{</span><span class="nv">encoding</span> <span class="ss">:edn</span>
            <span class="nv">host</span>     <span class="s">"localhost"</span>
            <span class="nv">port</span>     <span class="mi">53755</span><span class="p">}}</span>
    <span class="nv">value</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">req</span> <span class="p">(</span><span class="nf">request/Request</span>
              <span class="p">(</span><span class="nb">str </span><span class="s">"http://"</span> <span class="nv">host</span> <span class="s">":"</span> <span class="nv">port</span> <span class="s">"/submit"</span><span class="p">)</span>
              <span class="nv">**</span> <span class="ss">:data</span> <span class="p">(</span><span class="nf">serialize</span> <span class="nv">encoding</span> <span class="nv">value</span><span class="p">))]</span>
     <span class="p">(</span><span class="nf">.add_header</span>
      <span class="nv">req</span> <span class="s">"content-type"</span>
      <span class="p">(</span><span class="nf">case</span> <span class="nv">encoding</span>
        <span class="ss">:json</span>    <span class="s">"application/json"</span>
        <span class="ss">:transit</span> <span class="s">"application/transit+json"</span>
        <span class="ss">:edn</span>     <span class="s">"application/edn"</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">request/urlopen</span> <span class="nv">req</span><span class="p">))))</span>
</pre></div>
</div></div>

<p>
Now I can host a Portal instance on any of the existing runtimes and start
throwing data at it over the wire with <a href="https://clojuredocs.org/clojure.core/tap%3E">tap></a> via:
</p>

<div><div class="blog-post"><div class="highlight"><pre><span></span><span class="c1">;; in the basilisp repl</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">portal.client.py</span> <span class="ss">:as</span> <span class="nv">p</span><span class="p">])</span>
<span class="p">(</span><span class="k">def </span><span class="nv">submit</span> <span class="p">(</span><span class="nb">partial </span><span class="nv">p/submit</span> <span class="p">{</span><span class="ss">:port</span> <span class="mi">9999</span><span class="p">}))</span>
<span class="p">(</span><span class="nf">add-tap</span> <span class="o">#</span><span class="ss">'submit</span><span class="p">)</span>
</pre></div>
</div></div>

<p>
With the remote instance being opened via:
</p>

<div><div class="blog-post"><div class="highlight"><pre><span></span><span class="c1">;; in the remote process (jvm/node/clr/...)</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">portal.api</span> <span class="ss">:as</span> <span class="nv">p</span><span class="p">])</span>
<span class="p">(</span><span class="nf">p/open</span> <span class="p">{</span><span class="ss">:port</span> <span class="mi">9999</span> <span class="ss">:launcher</span> <span class="ss">:auto</span><span class="p">})</span>
</pre></div>
</div></div>

<p>
<note>
However, while pr-str is great for bootstrapping, it doesn't always guarantee
that the produced output is readable <a href="https://github.com/edn-format/edn">EDN</a>. The final client
will also support Portal's custom <a href="https://clojure.org/guides/reader_conditionals">.cljc</a> based serialization
format, but that will have to wait until after it is also ported.
</note>
</p>

<a href="#getting-some-tests-passing"><h2 class="G__7053" id="getting-some-tests-passing">Getting Some Tests Passing</h2></a>

<p>
After getting a client working, I continued with getting some tests passing,
typically <a href="https://github.com/djblue/portal/tree/master/test/portal/runtime">runtime tests</a>, and with Basilisp it
was no different. I started with <a href="https://github.com/djblue/portal/blob/master/src/portal/runtime/fs.cljc">portal.runtime.fs</a> specifically, as most
runtimes share slightly different but comparable filesystem APIs. Since the
surprises should be minimal, this also affords me the opportunity to start
getting comfortable working in this new and unfamiliar environment.
</p>

<p>
Of the existing fs APIs I've used, the python one felt the most like node.js. To
give you a sense of what this code looks like, here is the <a href="https://github.com/djblue/portal/blob/master/src/portal/runtime/fs.cljc#L123-L126">basename</a> fn:
</p>

<div><div class="G__7054">src/portal/runtime/fs.cljc</div><div class="blog-post"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">basename</span> <span class="p">[</span><span class="nv">path</span><span class="p">]</span>
  <span class="o">#</span><span class="nv">?</span><span class="p">(</span><span class="ss">:clj</span>  <span class="p">(</span><span class="nf">.getName</span> <span class="p">(</span><span class="nf">io/file</span> <span class="nv">path</span><span class="p">))</span>
     <span class="ss">:cljs</span> <span class="p">(</span><span class="nf">path/basename</span> <span class="nv">path</span><span class="p">)</span>
     <span class="ss">:cljr</span> <span class="p">(</span><span class="nf">Path/GetFileName</span> <span class="nv">path</span><span class="p">)</span>
     <span class="ss">:lpy</span>  <span class="p">(</span><span class="nf">os.path/basename</span> <span class="nv">path</span><span class="p">)))</span>
</pre></div>
</div></div>

<p>
One thing I noticed in Basilisp is the absence of <a href="https://clojuredocs.org/clojure.test/run-test">clojure.test/run-test</a>, but since a deftest will emit a var,
I've been invoking the test vars directly at the REPL. I think for now, testing
in Basilisp is focused around pytest. By the end of this port, I ended up
implementing <a href="https://github.com/djblue/portal/blob/master/test/portal/test_runner.lpy"><code>portal.test-runner</code></a>, which
has closer semantics and output to run-test. Perhaps in the future, something
like this will exist natively in Basilisp.
</p>

<p>
After googling around a bit on how to do various filesystem things in python,
the tests were passing and I was ready to tackle something more challenging.
</p>

<div><div id="2187894b-a62d-4958-b17a-b98309736c4e"></div><script type="text/javascript">(function (embed) {  embed.renderOutputItem({    mime: 'x-application/edn',    text: function () { return "\n^{:portal.viewer/inspector {:expanded 0}}\n{:pass 2,\n :type :pass,\n :ns portal.runtime.fs-test,\n :vars\n [{:type :pass,\n   :ns portal.runtime.fs-test,\n   :var\n   ^^{:portal.runtime/id 69} {:ns ^^{:portal.runtime/id 24} {:doc nil} portal.runtime.fs-test, :name fs-test, :file \"/home/chris/repos/portal/test/portal/runtime/fs_test.cljc\", :basilisp.test/test true, :line 5, :col 0, :end-line 30, :end-col 66, :arglists ^{:portal.runtime/id 25} ([])} #'portal.runtime.fs-test/fs-test,\n   :asserts 0}\n  {:type :pass,\n   :ns portal.runtime.fs-test,\n   :var\n   ^^{:portal.runtime/id 72} {:ns ^^{:portal.runtime/id 24} {:doc nil} portal.runtime.fs-test, :name modified, :file \"/home/chris/repos/portal/test/portal/runtime/fs_test.cljc\", :basilisp.test/test true, :line 32, :col 0, :end-line 35, :end-col 38, :arglists ^{:portal.runtime/id 25} ([])} #'portal.runtime.fs-test/modified,\n   :asserts 0}]}\n"; }  }, document.getElementById('2187894b-a62d-4958-b17a-b98309736c4e'))})(window.portal_api.embed())</script></div>

<a href="#getting-serialization-working"><h2 class="G__7053" id="getting-serialization-working">Getting Serialization Working</h2></a>

<p>
As mentioned above, Portal implements a custom serialization protocol <a href="https://github.com/djblue/portal/blob/master/src/portal/runtime/cson.cljc">CSON</a> to communicate values to the UI client. Portal initially
used <a href="https://github.com/cognitect/transit-clj">transit-clj</a> / <a href="https://github.com/cognitect/transit-cljs">transit-cljs</a>
which worked very well, but that was later replaced. Since Portal is primarily
used as a library, transitive dependency versions are resolved by the user. This
can sometimes be older versions which contain bugs that were fixed or missing
features that Portal needs to work. So in order to provide stability for users,
Portal opted to implement its own serialization. The upside of this decision has
been the ability to easily port the protocol to other Clojure runtimes.
</p>

<p>
CSON is implemented via the following <em>internal</em> protocol where
<b>buffer</b> is flat list that will eventually be converted to a JSON array so
any value added to the buffer must to be a valid JSON type:
</p>

<div><div class="G__7054">src/portal/runtime/cson.cljc</div><div class="blog-post"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">defprotocol </span><span class="nv">ToJson</span> <span class="p">(</span><span class="nf">to-json*</span> <span class="p">[</span><span class="nv">value</span> <span class="nv">buffer</span><span class="p">]))</span>

<span class="c1">;; CSON implementation for keywords</span>
<span class="p">(</span><span class="nf">extend-type</span> <span class="o">#</span><span class="nv">?</span><span class="p">(</span><span class="ss">:clj</span>  <span class="nv">clojure.lang.Keyword</span>
                <span class="ss">:cljr</span> <span class="nv">clojure.lang.Keyword</span>
                <span class="ss">:cljs</span> <span class="nv">Keyword</span>
                <span class="ss">:lpy</span> <span class="nv">lang.keyword/Keyword</span><span class="p">)</span>
  <span class="nv">ToJson</span>
  <span class="p">(</span><span class="nf">to-json*</span> <span class="p">[</span><span class="nv">value</span> <span class="nv">buffer</span><span class="p">]</span>
    <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="kd">ns </span><span class="p">(</span><span class="nb">namespace </span><span class="nv">value</span><span class="p">)]</span>
      <span class="p">(</span><span class="nb">-> </span><span class="nv">buffer</span>
          <span class="p">(</span><span class="nf">json/push-string</span> <span class="s">";"</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">json/push-string</span> <span class="nv">ns</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">json/push-string</span> <span class="p">(</span><span class="nb">name </span><span class="nv">value</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">-> </span><span class="nv">buffer</span>
          <span class="p">(</span><span class="nf">json/push-string</span> <span class="s">":"</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">json/push-string</span> <span class="p">(</span><span class="nb">name </span><span class="nv">value</span><span class="p">))))))</span>
</pre></div>
</div></div>

<p>
The complete implementation for the various Basilisp Clojure types looks very
similar to the above code. And as you can imagine, the parsing is simply the
inverse. However, while the implementation is compete, I haven't spent time
digging into the performance, and the Basilisp version of CSON appears to be the
slowest:
</p>

<a href="#cson-read-performance"><h3 class="G__7053" id="cson-read-performance">CSON Read Performance</h3></a>

<div><div id="aa89ecbf-5944-4298-81ac-304535e0c90b"></div><script type="text/javascript">(function (embed) {  embed.renderOutputItem({    mime: 'x-application/edn',    text: function () { return "\n^{:portal.viewer/default :portal.viewer/vega-lite}\n{:$schema \"https://vega.github.io/schema/vega-lite/v5.json\",\n :data\n {:values\n  [{:encoding :cson,\n    :min 0.88,\n    :benchmark \"clj/cson/read\",\n    :total 11.57,\n    :max 2.93,\n    :runtime :clj,\n    :med 0.95,\n    :avg 1.15,\n    :iter 10,\n    :test :read,\n    :data :all}\n   {:encoding :cson,\n    :min 1.76,\n    :benchmark \"bb/cson/read\",\n    :total 23.36,\n    :max 2.77,\n    :runtime :bb,\n    :med 2.4,\n    :avg 2.33,\n    :iter 10,\n    :test :read,\n    :data :all}\n   {:encoding :cson,\n    :min 0.37,\n    :benchmark \"cljs/cson/read\",\n    :total 4.86,\n    :max 0.86,\n    :runtime :cljs,\n    :med 0.44,\n    :avg 0.48,\n    :iter 10,\n    :test :read,\n    :data :all}\n   {:encoding :cson,\n    :min 2.32,\n    :benchmark \"cljr/cson/read\",\n    :total 24.93,\n    :max 3.75,\n    :runtime :cljr,\n    :med 2.37,\n    :avg 2.49,\n    :iter 10,\n    :test :read,\n    :data :all}\n   {:encoding :cson,\n    :min 3.82,\n    :benchmark \"nbb/cson/read\",\n    :total 52.69,\n    :max 6.47,\n    :runtime :nbb,\n    :med 5.45,\n    :avg 5.26,\n    :iter 10,\n    :test :read,\n    :data :all}\n   {:encoding :cson,\n    :min 79.67,\n    :benchmark \"py/cson/read\",\n    :total 844.86,\n    :max 90,\n    :runtime :py,\n    :med 83.36,\n    :avg 84.48,\n    :iter 10,\n    :test :read,\n    :data :all}]},\n :mark {:type :bar, :tooltip true},\n :encoding\n {:x {:aggregate :sum, :field :total},\n  :y\n  {:field :benchmark,\n   :type :ordinal,\n   :sort {:op :sum, :field :total, :order :descending}},\n  :color {:field :runtime}}}\n"; }  }, document.getElementById('aa89ecbf-5944-4298-81ac-304535e0c90b'))})(window.portal_api.embed())</script></div>

<a href="#cson-write-performance"><h3 class="G__7053" id="cson-write-performance">CSON Write Performance</h3></a>

<div><div id="75796692-cc5f-4fff-9e5e-f220d49fe4f8"></div><script type="text/javascript">(function (embed) {  embed.renderOutputItem({    mime: 'x-application/edn',    text: function () { return "\n^{:portal.viewer/default :portal.viewer/vega-lite}\n{:$schema \"https://vega.github.io/schema/vega-lite/v5.json\",\n :data\n {:values\n  [{:encoding :cson,\n    :min 0.64,\n    :benchmark \"clj/cson/write\",\n    :total 8.48,\n    :max 1.49,\n    :runtime :clj,\n    :med 0.77,\n    :avg 0.84,\n    :iter 10,\n    :test :write,\n    :data :all}\n   {:encoding :cson,\n    :min 2.01,\n    :benchmark \"bb/cson/write\",\n    :total 26.32,\n    :max 3.18,\n    :runtime :bb,\n    :med 2.75,\n    :avg 2.63,\n    :iter 10,\n    :test :write,\n    :data :all}\n   {:encoding :cson,\n    :min 0.22,\n    :benchmark \"cljs/cson/write\",\n    :total 2.7,\n    :max 0.34,\n    :runtime :cljs,\n    :med 0.27,\n    :avg 0.26,\n    :iter 10,\n    :test :write,\n    :data :all}\n   {:encoding :cson,\n    :min 1.74,\n    :benchmark \"cljr/cson/write\",\n    :total 17.73,\n    :max 1.82,\n    :runtime :cljr,\n    :med 1.77,\n    :avg 1.77,\n    :iter 10,\n    :test :write,\n    :data :all}\n   {:encoding :cson,\n    :min 4.01,\n    :benchmark \"nbb/cson/write\",\n    :total 59.57,\n    :max 6.62,\n    :runtime :nbb,\n    :med 6.17,\n    :avg 5.95,\n    :iter 10,\n    :test :write,\n    :data :all}\n   {:encoding :cson,\n    :min 16.24,\n    :benchmark \"py/cson/write\",\n    :total 164.9,\n    :max 16.75,\n    :runtime :py,\n    :med 16.54,\n    :avg 16.49,\n    :iter 10,\n    :test :write,\n    :data :all}]},\n :mark {:type :bar, :tooltip true},\n :encoding\n {:x {:aggregate :sum, :field :total},\n  :y\n  {:field :benchmark,\n   :type :ordinal,\n   :sort {:op :sum, :field :total, :order :descending}},\n  :color {:field :runtime}}}\n"; }  }, document.getElementById('75796692-cc5f-4fff-9e5e-f220d49fe4f8'))})(window.portal_api.embed())</script></div>

<p></p>

<a href="#getting-the-server-working"><h2 class="G__7053" id="getting-the-server-working">Getting The Server Working</h2></a>

<p>
After serialization is complete, things will typically ramp up in difficulty, as
the next step is getting an http server with websockets up and running. For
Basilisp specifically, it made me directly confront the single threaded nature
of python and learn the abstractions / APIs / libraries in the python
ecosystem. I settled on <a href="https://docs.aiohttp.org/en/stable/">aiohttp</a> as the http server library
and subsequently <a href="https://docs.python.org/3/library/asyncio.html">asyncio</a> for dealing with asynchronous io.
This code can be found in
<a href="https://github.com/djblue/portal/blob/master/src/portal/runtime/python/launcher.lpy">portal.runtime.python.launcher</a> and
<a href="https://github.com/djblue/portal/blob/master/src/portal/runtime/python/server.lpy">portal.runtime.python.server</a>.
</p>

<p>
An interesting implementation detail of the Portal http server, is how requests
are routed. Since Portal aims to be a multi-runtime application, early on I
chose to go with the most portable solution I could and settled on 
<code>defmethod</code>. This may seem like an odd solution, but with Portal's
goals in mind, I think it makes sense. The code looks like:
</p>

<div><div class="G__7054">src/portal/runtime/python/server.lpy</div><div class="blog-post"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">defmulti </span><span class="nv">route</span> <span class="p">(</span><span class="nf">juxt</span> <span class="ss">:request-method</span> <span class="ss">:uri</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defmethod </span><span class="nv">route</span> <span class="ss">:default</span> <span class="p">[</span><span class="nv">_request</span><span class="p">]</span>
  <span class="p">{</span><span class="ss">:status</span> <span class="mi">400</span><span class="p">})</span>

<span class="nv">...</span>

<span class="p">(</span><span class="kd">defmethod </span><span class="nv">route</span> <span class="p">[</span><span class="ss">:get</span> <span class="s">"/main.js"</span><span class="p">]</span> <span class="p">[</span><span class="nv">request</span><span class="p">]</span>
  <span class="p">{</span><span class="ss">:status</span>  <span class="mi">200</span>
   <span class="ss">:headers</span> <span class="p">{</span><span class="s">"Content-Type"</span> <span class="s">"text/javascript"</span><span class="p">}</span>
   <span class="ss">:body</span>
   <span class="p">(</span><span class="nf">fs/slurp</span>
    <span class="p">(</span><span class="nf">case</span> <span class="p">(</span><span class="nb">-> </span><span class="nv">request</span> <span class="ss">:session</span> <span class="ss">:options</span> <span class="ss">:mode</span><span class="p">)</span>
      <span class="ss">:dev</span> <span class="p">(</span><span class="nf">resource</span> <span class="s">"portal-dev/main.js"</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">resource</span> <span class="s">"portal/main.js"</span><span class="p">)))})</span>

<span class="nv">...</span>
</pre></div>
</div></div>

<p>
One outstanding issue I haven't been able to solve with the server is graceful
shutdown of the http server on <a href="https://cljdoc.org/d/djblue/portal/0.61.0/api/portal.api#stop"><code>portal.api/stop</code></a>. It typically works, but
when it doesn't the python process will not exit. This tends to happen
consistently on OSX and sometimes on CI.
</p>

<p>
The good news is that once I got comfortable with async/await in Basilisp, I was
able to get a mostly working server implemented for the UI.
</p>

<a href="#
updating-log-viewer
"><h2 class="G__7053" id="
updating-log-viewer
">
Updating log viewer
</h2></a>

<p>
Once the server was up and running, I could load the UI and start viewing data
from my Basilisp runtime. One namespace I enjoy using from Portal is <a href="https://cljdoc.org/d/djblue/portal/0.61.0/doc/guides/logging/portal-console?q=console#portalconsole"><code>portal.console</code></a>. It provides a few logging
functions that send values to Portal, just like <code>tap></code>, but also
includes extra data such as source location. Additionally, it will tag the
specific runtime the where data came from, in this case it would be python, so I
updated <code>:portal.viewer/log</code> to support that type of runtime. Here is
a preview of that viewer:
</p>

<div><div id="5548023a-edfd-4f9b-8070-3d9907333a88"></div><script type="text/javascript">(function (embed) {  embed.renderOutputItem({    mime: 'x-application/edn',    text: function () { return "\n^{:portal.viewer/default :portal.viewer/log\n  :portal.viewer/for {:time :portal.viewer/date-time}}\n{:ns basilisp.user,\n :time #inst \"2017-06-06T18:07:54.000-04:00\",\n :level :warn,\n :column 1,\n :line 1, \n :result :basilisp.user/py, \n :runtime :py, \n :form :basilisp.user/py}\n"; }  }, document.getElementById('5548023a-edfd-4f9b-8070-3d9907333a88'))})(window.portal_api.embed())</script></div>

<a href="#deployment"><h2 class="G__7053" id="deployment">Deployment</h2></a>

<p>
Once I ironed out all the bugs in the runtime code, and made sure it worked well
with the Portal UI, I was ready to build and deploy a package. For this, I
noticed that Basilisp itself uses <a href="https://python-poetry.org/">poetry</a> so I decided to do
the same. I setup the following <a href="https://python-poetry.org/docs/pyproject/">pyproject.toml</a>:
</p>

<div><div class="G__7054">pyproject.toml</div><div class="blog-post"><div class="highlight"><pre><span></span><span class="k">[project]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"djblue.portal"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">"0.60.1"</span>
<span class="n">license</span> <span class="o">=</span> <span class="p">{</span> <span class="n">file</span> <span class="o">=</span> <span class="s">"LICENSE"</span> <span class="p">}</span>
<span class="n">readme</span> <span class="o">=</span> <span class="s">"README.md"</span>
<span class="n">description</span> <span class="o">=</span> <span class="s">"A clojure tool to navigate through your data."</span>
<span class="n">authors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"djblue"</span><span class="p">,</span> <span class="n">email</span> <span class="o">=</span> <span class="s">"djblue@users.noreply.github.com"</span> <span class="p">},</span>
<span class="p">]</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="k">[ "clojure", "basilisp", "inspector", "portal", "datafy", "nav" ]</span>
<span class="n">requires-python</span> <span class="o">=</span> <span class="s">">= 3.8"</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"aiohttp>=3.11.11"</span><span class="p">,</span>
    <span class="s">"asyncio>=3.4.3"</span><span class="p">,</span>
    <span class="s">"basilisp>=0.4.0"</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">[tool.poetry]</span>
<span class="n">packages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">include</span> <span class="o">=</span> <span class="s">"portal"</span><span class="p">,</span> <span class="n">from</span> <span class="o">=</span> <span class="s">"src"</span> <span class="p">},</span>
<span class="p">]</span>
<span class="n">include</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"resources/portal/*"</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="p">[</span> <span class="s">"sdist"</span><span class="p">,</span> <span class="s">"wheel"</span> <span class="p">]</span> <span class="p">}</span>
<span class="p">]</span>

<span class="k">[project.urls]</span>
<span class="n">Homepage</span>  <span class="o">=</span> <span class="s">"https://github.com/djblue/portal"</span>
<span class="n">Standalone</span> <span class="o">=</span> <span class="s">"https://djblue.github.io/portal/"</span>
<span class="n">Documentation</span>  <span class="o">=</span> <span class="s">"https://cljdoc.org/d/djblue/portal/"</span>
<span class="n">Issues</span> <span class="o">=</span> <span class="s">"https://github.com/djblue/portal/issues"</span>
<span class="n">Changelog</span> <span class="o">=</span> <span class="s">"https://github.com/djblue/portal/blob/master/CHANGELOG.md"</span>

<span class="k">[build-system]</span>
<span class="n">requires</span> <span class="o">=</span> <span class="k">["poetry-core==2.1.3"]</span>
<span class="n">build-backend</span> <span class="o">=</span> <span class="s">"poetry.core.masonry.api"</span>
</pre></div>
</div></div>

<p>
An interesting bit here is the usage of `include = [ ... ]` to bundle the Portal
UI client in the distribution artifact. Moreover, I also discovered <a href="https://docs.python.org/3/library/importlib.resources.html">importlib.resources</a> which is super useful for
resolving static resources on your path, the same way you would do for java and
the classpath.
</p>

<a href="#conclusion"><h2 class="G__7053" id="conclusion">Conclusion</h2></a>

<p>
While this initial port represents the main pieces that need to be there to use
Portal, there are still some features that are missing but can be completed in
future releases. Things such as a nREPL middleware, support for launching editor
integrations and improved CSON performance.
</p>

<p>
Now with all of those details sorted out, I was able to deploy a version of
Portal to <a href="https://pypi.org/project/djblue.portal/">pypi</a> and now users can follow this <a href="https://cljdoc.org/d/djblue/portal/0.61.0/doc/guides/basilisp">simple guide</a> to get started with Basilip and Portal!
</p></div></article><div class="G__7052"><div id="disqus_thread"></div><script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'djblue'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a>comments powered by Disqus.</a><a class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></noscript></div></div></div></div></div></div></div></div></div></body></html>